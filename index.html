<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Docebo Test App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Keep a permissive but safe CSP for testing; your production host can tighten this -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https:; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self'; frame-ancestors *;">
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; }
    code { background: #f6f8fa; padding: 0.1rem 0.3rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Docebo Test App (GitHub Pages)</h1>
  <div class="card">
    <p>Embedded via Docebo External link (iframe). Emits arrival, heartbeat, and leave events.</p>
    <p id="status">Status: initializing…</p>
    <p>Now: <code id="now"></code></p>
  </div>
  <script>
    const sessionId = crypto.randomUUID();
    const startedAt = Date.now();
    const HEARTBEAT_MS = 30000; // 30s
    const iso = (t) => new Date(t).toISOString();

    async function send(eventType, extra={}) {
      const payload = { sessionId, eventType, ts: iso(Date.now()), ...extra };
      console.log("EVENT ➜", payload);
      // Later: POST to your server, not directly to Watershed.
      // await fetch("https://yourserver.example/track", { method:"POST", headers:{"content-type":"application/json"}, body: JSON.stringify(payload) });
    }

    // Arrival
    send("initialized", { startedAt: iso(startedAt) });

    // Heartbeat
    const hb = setInterval(() => send("heartbeat"), HEARTBEAT_MS);

    // Leave (best-effort)
    addEventListener("pagehide", () => {
      const durSec = (Date.now() - startedAt)/1000;
      send("terminated", { durationSec: Math.round(durSec) });
      clearInterval(hb);
    });

    // UI clock
    setInterval(()=>{ document.getElementById("now").textContent = iso(Date.now()); }, 1000);
    document.getElementById("status").textContent = "running";
  </script>
</body>
</html>
