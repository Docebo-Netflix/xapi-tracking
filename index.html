<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Docebo Test App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Keep a permissive but safe CSP for testing; your production host can tighten this -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https:; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self'; frame-ancestors *;">
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; }
    code { background: #f6f8fa; padding: 0.1rem 0.3rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Docebo Test App (GitHub Pages)</h1>
  <div class="card">
    <p>Embedded via Docebo External link (iframe). Emits arrival, heartbeat, and leave events.</p>
    <p id="status">Status: initializing…</p>
    <p>Now: <code id="now"></code></p>
  </div>
 <script>
  const RELAY = "https://xapi-tracking.onrender.com"; // ← paste your /track URL
  const ACTIVITY = "https://docebo-netflix.github.io/xapi-tracking/";
  const sessionStart = Date.now();

  // TODO: replace with real identity later (LTI claims or signed JWT)
  const userEmail = "test@example.com";
  const userName  = "Test Learner";

  async function send(eventType, extra={}) {
    try {
      await fetch(RELAY, {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify({
          eventType,
          userEmail,
          userName,
          activityId: ACTIVITY,
          courseId: "docebo:course:COURSE_ID",
          ...extra
        })
      });
    } catch (e) {
      console.warn("relay error", e);
    }
  }

  // Arrived
  send("initialized");

  // Heartbeat (optional, improves “left” accuracy)
  const hb = setInterval(() => send("interacted"), 30000);

  // Left (best-effort)
  addEventListener("pagehide", () => {
    clearInterval(hb);
    const dur = (Date.now() - sessionStart) / 1000;
    send("terminated", { durationSec: Math.round(dur) });
  });
</script>

</body>
</html>


